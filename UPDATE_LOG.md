# 更新日志

## 2025-09-07

### 新增功能
- 添加了一体化账单处理脚本 `run_complete_process.py`，整合了账单处理、数据导入和Metabase服务启动的完整流程
- 更新了README文档，添加了关于新整合脚本的使用说明
- 实现资产记录功能，支持导出当前资产的快照信息
- 实现账单数据增量导入功能，支持基于主键的去重和更新写入

### 改进优化
- 修复了Metabase数据导入脚本中的路径问题，使其可以在不同目录下正确执行
- 增强了脚本的健壮性，添加了错误处理和状态检查功能
- 更新资产记录功能，新增"对应人民币金额"和"资产/负债"两列
- 修复资产数据导入功能，支持增量写入SQLite数据库
- 清理测试数据污染问题，提供数据库维护方法
- 修复账单数据去重逻辑，使用MD5哈希生成账单主键，基于金额、日期、源账户、描述、代理信息进行去重
- 修正账单时间列语义，使用数据导入时间而非原始数据中的时间标记

### 版本发布 v1.0.0
- **支付宝账单解析功能**
  - 支持CSV格式账单文件解析
  - 自动识别文件编码
  - 智能分类系统，基于交易描述自动分类
  - 支持工资和公积金收入自动识别

- **微信账单解析功能**
  - 支持Excel格式账单文件解析
  - 处理微信账单特有的双层表头结构
  - 正确解析交易时间、金额、交易类型、交易对方等关键字段

- **银行账单解析功能**
  - 支持PDF格式账单文件解析
  - 初始支持招商银行信用卡账单
  - 解析交易日期、货币、金额、余额、交易类型、交易对方等字段

- **MoneyPro格式转换功能**
  - 统一转换为MoneyPro支持的CSV格式
  - 标准化字段映射（日期、金额、描述、类别、代理、源账户、货币）

- **账单去重功能**
  - 跨平台转账识别与去重
  - 优先保留支付宝或微信账单记录
  - 智能识别相似交易对方名称（如a.k.a. 小黄蜂）

- **投资类交易过滤**
  - 自动过滤朝朝宝、理财、基金等投资类交易
  - 支持扩展投资相关关键词

- **命令行接口**
  - 支持单个账单文件转换
  - 支持批量自动处理模式

- **配置管理**
  - 统一配置文件管理
  - 分类关键词词典维护

### 版本发布 v1.1.0
- 银行账单日期格式优化
  - 银行账单输出MoneyPro格式时，日期字段格式为 `yyyy-MM-dd hh:mm:ss`
  - 由于银行原始账单只有日期信息，时间部分默认填充 `00:00:00`
  - 在合并账 bill 去重过程中，使用原始日期进行匹配判断，确保与支付宝/微信账单正确去重

### 版本发布 v1.2.0
- 配置文件目录配置优化
  - 在配置文件中新增默认账单目录配置
  - 主函数批量导入账单时读取该目录配置
  - 修复批量导出账单时输出路径未读取配置文件目录的问题

### 版本发布 v1.3.0
- Metabase 集成
  - 引入开源 BI 产品 Metabase，支持将导出的结果账单导入到 Metabase 进行二次加工
  - Metabase 可部署在本地，数据保存在本项目中
  - 提供数据导入脚本，将 CSV 格式账单导入 SQLite 数据库
  - 提供 Docker Compose 配置文件用于本地部署 Metabase

### 版本发布 v1.4.0
- 域名访问支持
  - 为本地部署的 Metabase 添加域名访问支持
  - 使用 Nginx 作为反向代理实现域名访问
  - 默认域名为 billing.local
  - 提供域名配置说明和本地 hosts 文件配置指南

### 版本发布 v1.5.0
- 资产记录功能
  - 新增【原始资产】目录，用于维护资产信息CSV文件
  - 创建资产转换脚本，将原始资产信息转换为带时间戳的CSV格式
  - 更新Metabase导入脚本，支持将资产信息导入SQLite数据库
  - 在SQLite数据库中新增assets_records表，用于存储资产信息

### 版本发布 v1.5.1
- 资产记录功能优化
  - 更新资产记录输出模板，新增"对应人民币金额"和"资产/负债"两列
  - 修改资产转换脚本逻辑，根据币种自动计算对应人民币金额
  - 根据账户分类自动判断资产或负债属性
  - 更新SQLite数据库表结构以支持新增字段

## 2025-09-06

### 安全修复
- 从Git历史记录中彻底移除了SSL私钥文件，修复了严重的安全漏洞
- 更新了.gitignore文件，确保SSL证书目录不会被提交到版本控制系统
- 重新生成了SSL证书，并建立了防止敏感信息泄露的机制

### 功能增强
- 改进了SSL证书生成脚本，添加了Subject Alternative Name (SAN)扩展支持
- 更新了Nginx配置，增强了HTTPS安全性
- 提供了详细的证书信任指南，帮助用户解决浏览器安全警告问题

## 2025-09-05

### 核心功能
- 完成了支付宝、微信、银行账单的解析和转换功能
- 实现了账 bill 数据的合并和去重功能
- 完成了与Metabase的集成，支持数据导入和可视化分析
- 配置了Nginx反向代理，支持通过域名访问Metabase

### 优化改进
- 改进了银行账单处理逻辑，正确处理了金额符号
- 优化了转账记录过滤算法，提高了准确性
- 增强了投资类记录的过滤功能
- 完善了错误处理和日志输出机制

## 2025-09-04

### 核心功能
- 实现了支付宝账单解析功能
- 实现了微信账 bill 解析功能
- 实现了银行账 bill 解析功能
- 实现了MoneyPro格式转换功能

### 优化改进
- 完善了账 bill 去重功能
- 增加了投资类交易过滤功能
- 实现了命令行接口
- 添加了配置管理功能
